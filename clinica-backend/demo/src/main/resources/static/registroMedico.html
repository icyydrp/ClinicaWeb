<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Médico</title>
    <link rel="stylesheet" href="css/registroMedico.css">
</head>
<body>
    <div class="container">
        <!-- Formulario de registro de médico -->
        <div class="form-container">
            <form id="medicoForm">
                <h1>Registro de Médico</h1>
                <div class="input-container">
                    <input type="text" id="nombres" name="nombres" placeholder="Nombres" required />
                </div>
                <div class="input-container">
                    <input type="text" id="apellidos" name="apellidos" placeholder="Apellidos" required />
                </div>
                <div class="input-container">
                    <input type="text" id="numero_colegiatura" name="numero_colegiatura" placeholder="Número de Colegiatura" required />
                </div>
                <div class="input-container">
                    <input type="text" id="dni" name="dni" placeholder="DNI" required />
                </div>
                <div class="input-container">
                    <input type="text" id="especialidad" name="especialidad" placeholder="Especialidad" required />
                </div>
                <div class="input-container">
                    <input type="email" id="correo" name="correo" placeholder="Correo Electrónico" required />
                </div>
                <div class="input-container">
                    <input type="password" id="contraseñaMedico" name="contraseña" placeholder="Contraseña" required />
                    <small id="mensajeContraseña" style="color: red; display: none;">
                        La contraseña debe tener al menos 8 caracteres, una letra mayúscula, un número y un símbolo.
                    </small>
                </div>
                <div class="input-container">
                    <input type="password" id="verificarContraseñaMedico" name="verificarContraseña" placeholder="Verificar Contraseña" required />
                    <small id="mensajeCoincidencia" style="color: red; display: none;">
                        Las contraseñas no coinciden.
                    </small>
                </div>
                <button type="button" id="registrarMedicoBtn">Registrarme</button>
            </form>
            
            <script>
                document.getElementById('registrarMedicoBtn').addEventListener('click', function (event) {
                  // Obtener los datos del formulario
                  const nombres = document.getElementById('nombres').value.trim();
                  const apellidos = document.getElementById('apellidos').value.trim();
                  const numero_colegiatura = document.getElementById('numero_colegiatura').value.trim();
                  const dni = document.getElementById('dni').value.trim();
                  const especialidad = document.getElementById('especialidad').value.trim();
                  const correo = document.getElementById('correo').value.trim();
                  const contraseña = document.getElementById('contraseñaMedico').value.trim();
                  const verificarContraseña = document.getElementById('verificarContraseñaMedico').value.trim();
              
                  // Validación de campos vacíos
                  if (!nombres || !apellidos || !numero_colegiatura || !dni || !especialidad || !correo || !contraseña || !verificarContraseña) {
                    alert('Todos los campos son obligatorios.');
                    return;
                  }
              
                  // Expresión regular para validar la contraseña segura
                  const contraseñaSegura = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
              
                  let esValida = true;
              
                  // Validar si la contraseña cumple con los requisitos de seguridad
                  if (!contraseñaSegura.test(contraseña)) {
                    document.getElementById('mensajeContraseña').style.display = 'block';
                    esValida = false;
                  } else {
                    document.getElementById('mensajeContraseña').style.display = 'none';
                  }
              
                  // Validar si ambas contraseñas coinciden
                  if (contraseña !== verificarContraseña) {
                    document.getElementById('mensajeCoincidencia').style.display = 'block';
                    esValida = false;
                  } else {
                    document.getElementById('mensajeCoincidencia').style.display = 'none';
                  }
              
                  // Prevenir el envío del formulario si hay errores
                  if (!esValida) {
                    event.preventDefault();
                    return;
                  }
              
                  // Crear un objeto con los datos del médico
                  const medicoData = {
                    nombres: nombres,
                    apellidos: apellidos,
                    numero_colegiatura: numero_colegiatura,
                    dni: dni,
                    especialidad: especialidad,
                    correo: correo,
                    contraseña: contraseña,
                  };
              
                  // Enviar los datos al backend como JSON usando fetch
                  fetch('http://localhost:8080/medico/registrar', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(medicoData),
                  })
                    .then((response) => {
                      if (!response.ok) {
                        // Intentar convertir a JSON para ver si hay más información sobre el error
                        return response.json().then((errorData) => {
                          throw new Error(errorData.error || 'Error en la solicitud: ' + response.status);
                        }).catch(() => {
                          // Si la conversión a JSON falla, lanzar un error genérico
                          throw new Error('Error en la solicitud: ' + response.status);
                        });
                      }
                      return response.json();
                    })
                    .then((data) => {
                      if (data.mensaje) {
                        alert(data.mensaje);
                        window.location.href = "/paginaprincipalMedico.html";
                      }
                    })
                    .catch((error) => {
                      console.error('Error:', error);
                      alert('Hubo un error al registrar al médico: ' + error.message);
                    });
                });
              </script>
              
            
        </div>

        <!-- Contenedor del panel de bienvenida -->
        <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-right">
                    <h1>Hola, Bienvenido!</h1>
                    <p>Si ya eres un usuario registrado, inicia sesión en la página haciendo click en este botón de abajo</p>
                    <button class="ghost" onclick="window.location.href='login.html'">INICIAR SESION</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
